From 3e045d35d76197287aa615b44fc50de47726f8af Mon Sep 17 00:00:00 2001
From: Randall Leeds <randall.leeds@gmail.com>
Date: Tue, 7 Dec 2010 13:51:50 -0800
Subject: [PATCH] respect replicator settings

---
 src/couchdb/couch_rep_reader.erl |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/couchdb/couch_rep_reader.erl b/src/couchdb/couch_rep_reader.erl
index 52a8e53..034deeb 100644
--- a/src/couchdb/couch_rep_reader.erl
+++ b/src/couchdb/couch_rep_reader.erl
@@ -53,8 +53,10 @@ init([Parent, Source, MissingRevs, _PostProps]) ->
     process_flag(trap_exit, true),
     if is_record(Source, http_db) ->
         #url{host=Host, port=Port} = ibrowse_lib:parse_url(Source#http_db.url),
-        ibrowse:set_max_sessions(Host, Port, ?MAX_CONNECTIONS),
-        ibrowse:set_max_pipeline_size(Host, Port, ?MAX_PIPELINE_SIZE);
+        ibrowse:set_max_sessions(Host, Port,
+            proplists:get_value(max_sessions, Source#http_db.options, ?MAX_CONNECTIONS)),
+        ibrowse:set_max_pipeline_size(Host, Port,
+            proplists:get_value(max_pipeline_size, Source#http_db.options, ?MAX_PIPELINE_SIZE));
     true -> ok end,
     Self = self(),
     ReaderLoop = spawn_link(fun() -> reader_loop(Self, Source, MissingRevs) end),
-- 
1.7.1

