#!/bin/sh

install_prefix="/var/lounge/"

MODULES="--add-module=`pwd`/nginx_lounge_module"

JSON_CFLAGS=`pkg-config --cflags json`
JSON_LIBS=`pkg-config --libs-only-L json`

if [ -z $JSON_CFLAGS ] 
then
	echo "json-c not found"
	exit
fi

CFLAGS="--with-cc-opt=$JSON_CFLAGS"
LIBS="--with-ld-opt=$JSON_LIBS"

PREFIX="--prefix=/var/lounge/nginx"
SBIN="--sbin-path=/var/lounge/sbin/nginx"
CONF="--conf-path=/var/lounge/etc/nginx/nginx.conf"
ACCESS_LOG="--http-log-path=/var/lounge/log/nginx/access.log"
ERROR_LOG="--error-log-path=/var/lounge/log/nginx/error.log"
PID="--pid-path=/var/lounge/nginx/pid/nginx.pid"
LOCK="--lock-path=/var/lounge/nginx/lock/nginx.lock"

if [ ! -d nginx ]
then
	tar xvzf nginx_src/nginx-0.7.22.tar.gz
	ln -sf nginx-0.7.22 nginx
fi

if [ ! -d nginx ]
then
	echo "Can't untar the nginx src!"
	exit
fi

cd nginx
#echo ./configure $PREFIX $SBIN $CONF $ACCESS_LOG $ERROR_LOG $PID $LOCK $MODULES $CFLAGS $LIBS
./configure $PREFIX $SBIN $CONF $ACCESS_LOG $ERROR_LOG $PID $LOCK $MODULES $CFLAGS $LIBS
cd ..
