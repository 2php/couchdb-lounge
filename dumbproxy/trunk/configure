#!/bin/sh

install_prefix="/var/lounge/"

MODULES="--add-module=`pwd`/nginx_lounge_module"

CFLAGS="--with-cc-opt=`pkg-config --cflags json`"
LIBS="--with-ld-opt=`pkg-config --libs json`"

PREFIX="--prefix=/var/lounge/nginx"
SBIN="--sbin-path=/var/lounge/sbin/nginx"
CONF="--conf-path=/var/lounge/etc/nginx/nginx.conf"
ACCESS_LOG="--http-log-path=/var/lounge/log/nginx/access.log"
ERROR_LOG="--error-log-path=/var/lounge/log/nginx/error.log"
PID="--pid-path=/var/lounge/nginx/pid/nginx.pid"
LOCK="--lock-path=/var/lounge/nginx/lock/nginx.lock"

echo "install_prefix = $install_prefix"
echo "modules = $modules"
echo "debug_flag = $debug_flag"
echo "Running the following command:"
echo "nginx/configure --prefix=$install_prefix $modules $debug_flag"

cd nginx
#./configure --prefix=$install_prefix --with-cc-opt=$CFLAGS --with-ld-opt=$LIBS $modules $debug_flag 

./configure $PREFIX $SBIN $CONF $ACCESS_LOG $ERROR_LOG $PID $LOCK $MODULES $CFLAGS $LIBS
cd ..
